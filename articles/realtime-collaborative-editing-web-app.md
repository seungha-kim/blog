# 2021-07 Rust, wasm-pack 을 활용한 실시간 동시편집 웹 어플리케이션 아키텍처

요약 - Figma 블로그 내용을 바탕으로, 단일리더 분산 시스템에 기반한 간단한 실시간 동시편집 웹 어플리케이션을 만들어 본 경험을 소개한다. Rust, wasm-pack

## 실시간 동시편집 웹 어플리케이션의 요구사항
- 여러 사용자가 네트워크로 상호간 연결된 상태에서 하나의 문서를 편집한다
- 다른 사용자가 편집한 내용을 준실시간으로 확인할 수 있다

## 해결해야 하는 문제

- 시간 차이 때문에 다른 사용자의 편집 내용을 보지 못한 상태에서 편집을 하는 상황이 생길 수 있음. 충돌 처리
- 잠시동안 네트워크에 문제가 발생하더라도 네트워크가 복구되었을 때 문제없이 편집을 이어나갈 수 있다

## Figma에서 공개한 내용

일반적으로는 CRDT가 회자된다. 하지만 Figma 는 CRDT를 사용하지 않았음
- Figma 글 요약
	- CRDT 까지 필요하지 않다. CRDT는 복잡... 이런 방식은 구현이 간단해서

실제로 이런 제약사항 때문에 Figma 서버에 문제가 생기면 아예 편집기를 쓸 수 없는 상황이 발생하기도 한다.
(Slack 에서 찾아보기)

## 아키텍처 설계
- 간단한 트랜잭션 키-밸류 인 메모리 데이터베이스 - 트랜잭션 레이어링 아이디어
- invalidation

## 기술 스택

Why Rust?

- 원래부터 좋아하는 언어라 그냥 쓰고 싶어서... + Figma 에서 썼다고 해서
- Client, server 에서 같은 언어를 썼을 때 장점이 있을 거라 생각했음
- serde 로 de/serialization 작업 대충 빠르게 작성
- 최근 async/await API 및 그 생태계가 성숙되어 안정된 API에 기반해서 웹/소켓 서버를 만들 수 있게 되었다.

- 간단히 하기 위해서 SVG 선택 - canvas 엘리먼트나 CanvanKit 같은 것 사용할 수 있을 것
- Preact - SVG 그대로 쓸 수 있음

## 여러가지 선택사항
- validation nack 어떻게 할 것인가
- undo 하다가 validation error가 난다면? 일부만 적용할 것인가? undo stack을 날려버릴 것인가?

## 남겨진 과제
- high availability
- persistence - 분산 트랜잭션을 지원하는 분산 데이터베이스... MongoDB 를 사용하면 되지 않을까?

## TODOS
- [ ] 그림 그리기